{% extends "base.md.j2" %}

{% block content %}
# 📊 Decision Option Comparison: {{ data.decision.title }}

**Comparison Date:** {{ format_date('now', 'FULL') }}

{% if data.decision.description %}
{{ data.decision.description }}
{% endif %}

---

## ⚖️ Side-by-Side Comparison

{% if data.options %}
{% set option_count = data.options | length %}

### Overall Scores

| Rank | Option | Overall Score | Cost | Timeline |
|------|--------|---------------|------|----------|
{% for option in data.options %}
| {% if loop.index == 1 %}🥇{% elif loop.index == 2 %}🥈{% elif loop.index == 3 %}🥉{% else %}{{ loop.index }}{% endif %} | **{{ option.name }}** | {{ health_score(option.score | default(0.5), '') }} ({{ "%.1f"|format((option.score | default(0.5)) * 100) }}%) | {{ option.estimated_cost | default('TBD') }} | {{ option.estimated_time | default('TBD') }} |
{% endfor %}

---

## 🎯 Criterion-by-Criterion Analysis

{% set criteria = data.options[0].criteria_scores.keys() | list if data.options else [] %}

{% for criterion_name in criteria %}
### {{ criterion_name.replace('_', ' ').title() }}

{% for option in data.options %}
- **{{ option.name }}**: {{ health_score(option.criteria_scores.get(criterion_name, 0.5), '') }} ({{ "%.1f"|format(option.criteria_scores.get(criterion_name, 0.5) * 100) }}%)
{% endfor %}

{% set best_option = data.options | sort(attribute='criteria_scores.' ~ criterion_name, reverse=true) | first %}
{% if best_option %}
{{ emoji.success }} **Best performer**: {{ best_option.name }}
{% endif %}

---
{% endfor %}

## ✅ Pros Comparison

{% for option in data.options %}
### {{ option.name }}
{% if option.pros %}
{% for pro in option.pros %}
- {{ emoji.success }} {{ pro }}
{% endfor %}
{% else %}
- {{ emoji.info }} No specific advantages identified
{% endif %}

{% endfor %}

---

## ⚠️ Cons Comparison

{% for option in data.options %}
### {{ option.name }}
{% if option.cons %}
{% for con in option.cons %}
- {{ emoji.warning }} {{ con }}
{% endfor %}
{% else %}
- {{ emoji.success }} No significant disadvantages identified
{% endif %}

{% endfor %}

---

## 💰 Cost-Benefit Analysis

{% if data.options %}
| Option | Estimated Cost | Est. Timeline | Overall Score | Cost Efficiency |
|--------|----------------|---------------|---------------|-----------------|
{% for option in data.options %}
| {{ option.name }} | {{ option.estimated_cost | default('Unknown') }} | {{ option.estimated_time | default('Unknown') }} | {{ "%.1f"|format((option.score | default(0.5)) * 100) }}% | {% if option.estimated_cost and option.estimated_cost != 'Unknown' and option.estimated_cost != 'TBD' %}{% if option.score > 0.7 %}{{ emoji.success }} High{% elif option.score > 0.5 %}{{ emoji.info }} Medium{% else %}{{ emoji.warning }} Low{% endif %}{% else %}{{ emoji.info }} TBD{% endif %} |
{% endfor %}
{% endif %}

---

## 🎓 Recommended Choice

{% if data.recommendation %}
### {{ emoji.success }} Recommended: {{ data.recommendation.option }}

**Confidence**: {{ health_score(data.recommendation.confidence, '') }} ({{ "%.1f"|format(data.recommendation.confidence * 100) }}%)

#### Why This Option?
{{ data.recommendation.reasoning }}

{% if data.recommendation.implementation_notes %}
#### Implementation Considerations
{{ data.recommendation.implementation_notes }}
{% endif %}

{% if data.options %}
{% set recommended_opt = data.options | selectattr('name', 'equalto', data.recommendation.option) | first %}
{% if recommended_opt %}
#### Recommended Option Summary
- **Overall Score**: {{ "%.1f"|format((recommended_opt.score | default(0.5)) * 100) }}%
- **Estimated Cost**: {{ recommended_opt.estimated_cost | default('TBD') }}
- **Estimated Timeline**: {{ recommended_opt.estimated_time | default('TBD') }}
- **Key Strengths**: {{ recommended_opt.pros | join(', ') if recommended_opt.pros else 'See detailed analysis' }}
{% endif %}
{% endif %}

{% else %}
{{ emoji.info }} No specific recommendation available. Review comparison data above to make informed decision.
{% endif %}

---

## 🔄 Alternative Scenarios

{% if data.options and data.options | length > 1 %}
### If Budget is Primary Constraint
{% set budget_options = data.options | sort(attribute='estimated_cost') %}
Consider: **{{ budget_options[0].name }}** (Estimated cost: {{ budget_options[0].estimated_cost | default('TBD') }})

### If Timeline is Critical
{% set timeline_options = data.options | sort(attribute='estimated_time') %}
Consider: **{{ timeline_options[0].name }}** (Estimated timeline: {{ timeline_options[0].estimated_time | default('TBD') }})

### If Quality/Score is Paramount
{% set score_options = data.options | sort(attribute='score', reverse=true) %}
Consider: **{{ score_options[0].name }}** (Overall score: {{ "%.1f"|format((score_options[0].score | default(0.5)) * 100) }}%)
{% endif %}

---

## 📅 Decision Timeline

{% if data.decision.deadline %}
**Decision Deadline**: {{ data.decision.deadline if data.decision.deadline is string else format_date(data.decision.deadline, 'SHORT') }}

{% if data.decision.urgency == 'critical' %}
{{ emoji.warning }} **CRITICAL**: Decision required immediately
{% elif data.decision.urgency == 'high' %}
{{ emoji.info }} **HIGH PRIORITY**: Decision needed within days
{% else %}
{{ emoji.info }} **NORMAL PRIORITY**: Follow standard decision process
{% endif %}
{% else %}
**Decision Deadline**: Not specified - Recommend setting clear deadline
{% endif %}

### Recommended Next Steps
{% if data.next_steps %}
{% for step in data.next_steps %}
{{ loop.index }}. {{ step.action }} (Owner: {{ step.owner | default('TBD') }}, Due: {{ step.deadline | default('TBD') }})
{% endfor %}
{% else %}
1. Review comparison data and discuss with stakeholders
2. Make final decision based on priorities and constraints
3. Communicate decision and implementation plan
4. Track decision outcomes and lessons learned
{% endif %}

{% endblock %}
